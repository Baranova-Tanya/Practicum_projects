# Прогнозирование удоя и вкуса молока

## Описание проекта
Проект по заказу фермера, владельца молочного хозяйства «Вольный луг». Он хочет купить коров, чтобы расширить поголовье стада. И для этого заключил контракт с ассоциацией пастбищ «ЭкоФерма».
«ЭкоФерма» готова предоставить подробные данные о своих коровах для тщательного отбора перед покупкой. 

Фермер определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Он хочет, чтобы каждая корова давала не менее 6000 килограммов молока в год, причем молоко должно быть вкусным (по собственной классификации фермера).

Известно, что технологи фермера планируют для новых коров увеличить значения характеристик корма на 5%.

Разработаем модель машинного обучения, которая поможет фермеру принять объективное решение о покупке. Создадим две прогнозные модели:
* для прогноза возможного удоя коровы (целевой признак `Удой`);
* для расчета вероятности получить вкусное молоко от коровы (целевой признак `Вкус молока`).

С помощью моделей отберем коров по двум критериям:
* средний удой за год — не менее 6000 килограммов;
* молоко вкусное.

## Описание данных

Дано три датасета:
1. `ferma_main.csv`;
2. `ferma_dad.csv`;
3. `cow_buy.csv`.

В содержатся следующие данные:
1. Файл `ferma_main.csv` содержит данные о стаде фермера на текущий момент (разделили признаки на группы в зависимости от того, характеризуют они корову, молоко, корм или пастбище):

|название столбца|содержащиеся данные|группа признаков|
|:-|:-|:-|
|id|уникальный идентификатор коровы|характеристика коровы|
|Удой, кг|масса молока, которую корова даёт в год (в килограммах)|характеристика молока|
|ЭКЕ (Энергетическая кормовая единица)|показатель питательности корма коровы|характеристика корма|
|Сырой протеин, г|содержание сырого протеина в корме (в граммах)|характеристика корма|
|СПО (Сахаро-протеиновое соотношение)|отношение сахара к протеину в корме коровы|характеристика корма|
|Порода|порода коровы|характеристика коровы|
|Тип пастбища|ландшафт лугов, на которых паслась корова|характеристика пастбища|
|порода папы_быка|порода папы коровы|характеристика коровы|
|Жирность, %|содержание жиров в молоке (в процентах)|характеристика молока|
|Белок, %|содержание белков в молоке (в процентах)|характеристика молока|
|Вкус молока|оценка вкуса по личным критериям фермера, бинарный признак (`вкусно`, `не вкусно`)|характеристика молока|
|Возраст|возраст коровы, бинарный признак (`менее_2_лет`, `более_2_лет`)|характеристика коровы|

2. Файл `ferma_dad.csv` хранит имя папы каждой коровы в стаде фермера:

|название столбца|содержащиеся данные|
|:-|:-|
|id|уникальный идентификатор коровы|
|Имя Папы|имя папы коровы|

3. Файл `cow_buy.csv` — это данные о коровах «ЭкоФермы», которых фермер хочет изучить перед покупкой:

|название столбца|содержащиеся данные|группа характеристик|
|:-|:-|:-|
|Порода|порода коровы|характеристика коровы|
|Тип пастбища|ландшафт лугов, на которых паслась корова|характеристика пастбища|
|порода папы_быка|порода папы коровы|характеристика коровы|
|Имя_папы|имя папы коровы|характеристика коровы|
|Текущая_жирность,%|содержание жиров в молоке (в процентах)|характеристика молока|
|Текущий_уровень_белок,%|содержание белков в молоке (в процентах)|характеристика молока|
|Возраст|возраст коровы, бинарный признак (`менее_2_лет`, `более_2_лет`)|характеристика коровы|

## Ход работы и выводы по проекту
1. При загрузке и первом просмотре данных:
* переименовали столбцы во всех таблицах (латинское написание, нижний регистр, змеиный стиль);
* ни в одной из таблиц не обнаружили пропусков.
2. Выполнили предобработку данных:
* изменили формат представления данных о возрасте коров и вкусе молока:
    - `более_2_лет` заменили на 1;
    - `менее_2_лет` заменили на 0;
    - `вкусно` заменили на 1;
    - `не вкусно` заменили на 0;
* удалили явные дубликаты в таблице `ferma_main`;
* оставили дубликаты в таблице `cow_buy`;
* обработали неявные дубликаты в данных о породах и типе пастбищ в таблицах `ferma_main` и `cow_buy`, унифицировали значения;
* добавили в таблицу `ferma_main` данные об имени отца из таблицы `ferma_dad`.
3. Выполнили исследовательский анализ данных:
* обработали одно аномальное значение в столбце `milk_yield`;
* в остальных данных явно ошибочных значений не обнаружено, выбросов очень мало;
* средние значения всех количественных показателей близки к медианам, что также подтверждает отсутствие большого числа выбросов и говорит о близости распределений к нормальным;
* распределения всех количественных показателей близки к нормальным с некоторыми нюансами (смещение влево или вправо, мультимодальность);
* для коров в стаде фермера характерны:
  - удои от 5746 до 6501 кг;
  - потребление кормовых единиц от от 13.5 до 15.6 (при этом разница между минимумом и макимумом 5.9 говорит о том, что коровы питаются по-разному; некоторые из них получают почти в полтора раза больше питательных веществ, чем другие; это подтверждает количество протеина в корме);
  - сахаро-протеиновое отношение в корме от 0,84 до 0,94 (что соответствует потребностям крупного рогатого скота);
  - жирность молока 3.59–3.72% (это меньше, чем можно было бы ожидать от коров голштинской породы);
  - белковость молока тоже меньше, чем можно было бы ожидать; 
* большинство коров в стаде фермера:
  - относятся к линии `Вис Бэк Айдиал` (их ощутимо больше, чем коров линии `Рефлекшн Соверинг`, но и тех и других достаточно много, чтобы можно было делать выводы об их качествах);
  - пасутся на холмистых пастбищах;
  - являются дочерьми быков одной из двух линий: `Вис Бэк Айдиал` или `Рефлекшн Соверинг` (количества почти равны);
  - дают вкусное, по собственной оценке владельца, молоко (при этом коров, дающих не вкусное молоко, тоже достаточно много, что позволит выяснить, какие данные в какой степени связаны со вкусом молока);
  - старше 2 лет (вполне ожидаемо для молочной фермы: коровы редко телятся раньше, чем достигнут 25 месяцев);
  - являются доферьми быков по имени Буйный и Барин (дочерей Соловчика и Геркулеса гораздо меньше);
* данные в таблице `cow_buy` согласуются с данными таблицы `ferma_main`, значит, можно ожидать от модели, обученной на данных о фермерском стаде, адекватных предсказаний удоев и вкуса молока покупаемых коров.

4. В ходе корреляционного анализа:
* обнаружена неожиданная вариантивность признака `dads_breed` у коров с одинаковыми `dads_name` (следует обратиться за разъяснениями к фермеру, но на построение прогноза это не должно оказать большого влияния);
* сильные линейные положительные связи между:
  - `milk_yield` и `sugar_protein_ratio`;
  - `milk_yield` и `feed_unit`;
  - `feed_unit` и `sugar_protein_ratio`;
* средние линейные положительные связи между:
  - `milk_yield` и `fat_in_milk`;
  - `sugar_protein_ratio` и `fat_in_milk`;
* средние нелинейные связи между:
  - `milk_yield` и `is_older`;
  - `feed_unit` и `is_older`;
  - `sugar_protein_ratio` и `is_older`;
  - `fat_in_milk` и `is_older`;
* введен и расчитан новый показатель `sugar_in_feed` (содержание сахара в корме), имеющий среднюю взаимосвязь с `milk_yield`;
* слабая нелинейная связь между `dads_name` и `milk_yield`;
* на диаграммах рассеяния `sugar_protein_ratio` отчетливо видны два кластера (меньше 0.92 и больше 0.92);
* `is_taste_good` связан с:
  - `pasture_type` (коровы, пасущиеся на холмистых пастбищах ощутимо чаще дают вкусное молоко, а коровы, пасущиеся на равнинных дугах немного чаще дают не вкусное молоко);
  - `is_older` (молоко коров старше 2 лет существенно чаще оказывается вкусным, а молоко молодых коров немного чаще оказывается не вкусным; при этом стоит помнить, что тип пастбища и возраст тоже имеют некоторую взаимосвязь);
  - `dads_name` (дочери Барина и Буйного немного чаще дают вкусное молоко);
* устранили мультиколлинеарность.
5. Спрогнозировали удои молока при помощи модели линейной регрессии:
* построили 3 модели, проанализировали их метрики и остатки:
  - по мере совершенствования моделей росла метрика `r_2`, метрики `mae`, `mse`, `rmse` – уменьшались, варьировалось распределение остатков;
  - в ходе совершенствования моделей учли нелинейность связей между признаками, для чего ввели новые рассчетные признаки;
* для фермера наиболее важно, чтобы реальный удой не оказался меньше предсказанного, поэтому вторая модель сочтена оптимальной (ее остатки ближе к 0, а метрики не значительно хуже третьей, при этом первую она превосходит по всем параметрам);
* для применения модели к реальным данным расчитали характеристики корма, отсуствовавшие в изначальных данных от `ЭкоФермы` (для этого взяли из таблицы `ferma_main` средние значения каждого из признаков и увеличили их на 5% в соответствии с планами технологов фермера);
* в результате прогнозирования определили, что все 20 рассматриваемых коров будут давать требуемое количество молока (при соблюдении кормовых характеристик).
6. Спрогнозировали вкус молока при помощи модели логистической регрессии:
* для фермера критичны ошибки первого рода `FalsePositive`,  метрика `precision` в данном случае важнее метрики `recall`; 
* необходимо было построить такую модель, которая не допускает ошибок первого рода (соответственно, `precision = 1`);
* для построения модели ввели два новых расчетных признака:
  - `fat_in_milk_bi`;
  - `fat_protein_ratio`;
* построенная нами модель с трудом может быть признана удовлетворительной, поскольку только 5% коров, дающих вкусное молоко, распознаются моделью, а число ошибок второго рода чрезмерно велико, но при определенных допущениях фермер сможет с ее помощью выбрать коров для покупки.

## Рекомендации

1. Однозначно к покупке можно рекомендовать двух коров, поскольку только для них мы уверенно предсказываем хороший вкус молока, а достаточные удои – для всех 20 коров;
2. Чтобы взвешенно принять решение о покупке прочих коров (если это необходимо), в таблице есть столбец `y_proba`, который содержит нашу оценку вероятности того, что корова дает вкусное молоко;
3. Чтобы сделать работу модели более точной, нужно больше данных, связанных со вкусом молока (в предоставленных данных почти никакие показатели не имеют значимого влияния на вкус молока, поэтому прогнозы такие несовершенные), например:

  - о содержании лактозы в молоке (это один из ключевых параметров, определяющих вкус);
  - о содержании солей в молоке;
  - о семействе коровы (наследственность по материнской линии влияет на вкусовые качества молока);
  - о употребляемой воде;
  - о годе рождения коровы или числе лактаций (это влияет и на удой, и на вкус молока).
