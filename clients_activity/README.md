# Предсказание покупательской активности клиентов интернет-магазина
## Описание проекта
Интернет-магазин «В один клик», продающий разные товары (для детей, для дома, мелкую бытовую технику, косметику, продукты), столкнулся со снижением активности покупателей. Руководство намерено удерживать активность постоянных клиентов с помощью персонализированных предложений.

Цель проекта — разработка решения, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.

Построим модель для предсказания вероятности снижения покупательской активности клиента в следующие три месяца.

Используя данные модели и данные о прибыльности клиентов, выделим сегменты покупателей и разработаем для них персонализированные предложения.
## Описание данных
Данные находятся в четырех таблицах:
1. `market_file.csv` (данные о поведении покупателя на сайте, о коммуникациях с покупателем и его продуктовом поведении)

|название столбца|содержащиеся данные|
|:-|:-|
|`id`|номер покупателя в корпоративной базе данных|
|`Покупательская активность`|рассчитанный класс покупательской активности (целевой признак): `снизилась` или `прежний уровень`|
|`Тип сервиса`|уровень сервиса: `премиум` или `стандарт`|
|`Разрешить сообщать`|информация о том, разрешил ли покупатель присылать ему дополнительные предложения о товаре|
|`Маркет_актив_6_мес`|среднемесячное значение маркетинговых коммуникаций на покупателя за последние 6 месяцев|
|`Маркет_актив_тек_мес`|количество маркетинговых коммуникаций в текущем месяце|
|`Длительность`|количество дней, прошедших с момента регистрации покупателя на сайте|
|`Акционные_покупки`|среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев|
|`Популярная_категория`|самая популярная категория товаров у покупателя за последние 6 месяцев|
|`Средний_просмотр_категорий_за_визит`|среднее количество категорий, просмотренных за визит в течение последнего месяца|
|`Неоплаченные_продукты_штук_квартал`|общее число неоплаченных товаров в корзине за последние 3 месяца|
|`Ошибка_сервиса`|число сбоев, которые коснулись покупателя во время посещения сайта|
|`Страниц_за_визит`|среднее количество страниц, просмотренных за один визит на сайт за последние 3 месяца|

2. `market_money.csv` (данные о выручке, которую получает магазин с покупателя)

|название столбца|содержащиеся данные|
|:-|:-|
|`id`|номер покупателя в корпоративной базе данных|
|`Период`|название периода, во время которого зафиксирована выручка|
|`Выручка`|сумма выручки за период|

3. `market_time.csv` (данные о времени в минутах, которое покупатель провел на сайте в течение периода)

|название столбца|содержащиеся данные|
|:-|:-|
|`id`|номер покупателя в корпоративной базе данных|
|`Период`|название периода, во время которого зафиксировано общее время|
|`минут`|значение времени, проведённого на сайте, в минутах|

4. `money.csv` (данные о среднемесячной прибыли от покупателя за последние 3 месяца)

|название столбца|содержащиеся данные|
|:-|:-|
|`id`|номер покупателя в корпоративной базе данных|
|`Прибыль`|значение прибыли|

## Ход работы и выводы по проекту
1. **Целью** была разработка решения, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность. Исходные данные включали признаки, описывающие:
* коммуникацию сотрудников компании с клиентом;
* продуктовое поведение;
* покупательское поведение;
* поведение на сайте.
2. Выполнили **предобработку данных**:
* заполнять пропуски, преобразовывать типы данных и обрабатывать дубликаты не понадобилось;
* привели названия столбцов к нижнему регистру, заменили в них пробелы на нижнее подчеркивание. Кириллическое написание оставлено для удобства понимания сути данных;
* обнаружили и исправили опечатки в данных типа `object`.
3. Выполнили **исследовательский анализ данных**. Обнаружили:
* в таблице `market_file`:
    * отсутствуют аномальные значения, очень мало выбросов; 
    * 8 количественных признаков (из них 2 могут быть рассмотрены и как категориальные без дополнительных преобразований) и 4 категориальных;
    * не все количественные признаки распределены нормально;
    * все категориальные признаки распределены неравномерно;
    * необходим учет дисбаланса классов;

* в таблице `market_money_piv` (получена из таблицы `market_money`):
    * 1 аномальное значение (удалили его), 3 выброса (проигнорировали при анализе);
    * все распределения близки к нормальным;
    * рост выручки, который может быть связан с сезонностью или/и с ростом цен;

* в таблице `market_time_piv` (получена из таблицы `market_time`):
    * отсутствуют аномальные значения, очень мало выбросов;
    * рассмотрели 3 количественных признака (время, проведенное на сайте в разные месяцы и суммарно); 
    * распределения стремятся к нормальному, смещенному влево, скошенному вправо;
    * в обоих месяцах медиана близка к среднему (около 13);
    * в текущем месяце большинство пользователей проводит на сайте от 10 до 16 минут, то есть на 1 минуту меньше, чем в предыдущем;
    * сумма за 2 месяца распределена более симметрично; 

* в таблице `money`:
    * неясно, какие значения можно было бы счесть аномальными, поскольку неизвестно, в чем измеряется прибыль;
    * выбросов мало, и они не очень сильно удалены от границ "усов" диаграммы размаха;
    * распределение похоже на нормальное, смещенное вправо;
    * медиана близка к среднему;
    * график плотности распределения не пологий, немного скошен влево.
4. Объединили таблицы `market_file`, `market_money_piv` и `market_time_piv`.
5. Выполнили **корреляционный анализ**. Он показал взаимосвязи:
* между количественными признаками: 
    * заметили 2 кластера взаимосвязанных признаков (большая часть связей сильная):
      * связанный с выручкой:
          * `выручка_2_мес_назад`;
          * `выручка_1_мес_назад`;
          * `выручка_текущий_месяц`;
          * `выручка_3_мес`;
      * связанный со временем на сайте:
          * `минуты_1_мес_назад`;
          * `минуты_текущий_месяц`;
          * `минуты_2_мес`;
    * других сильных связей нет;
    * есть средние связи:
      * `маркет_актив_6_мес` и кластер времени на сайте;
      * `маркет_актив_6_мес` и `страниц_за_визит`;
      * `акционные_покупки` и `страниц_за_визит`;
      * `акционные_покупки` и кластер времени на сайте;
      * `акционные_покупки` и кластер выручки;
      * `страниц_за_визит` и `выручка_2_мес_назад`;
      * `страниц_за_визит` и кластер времени на сайте;
      * `выручка_2_мес_назад` и кластер времени на сайте;
    * есть множество слабых связей;
* между категориальными и количественными признаками:
    * особенно сильных взаимосвязей нет;
    * есть сильные связи:
      * `покупательская_активность` и `страниц_за_визит`;
      * `покупательская_активность` и `минуты_2_мес`.
    * есть средние связи:
      * `покупательская_активность` и `маркет_актив_6_мес`;
      * `покупательская_активность` и `акционные_покупки`;
      * `покупательская_активность` и `средний_просмотр_категорий_за_визит`;
      * `покупательская_активность` и `неоплаченные_продукты_штук_квартал`;
      * `покупательская_активность` и `выручка_2_мес_назад`;
      * `покупательская_активность` и `минуты_1_мес_назад`;
      * `покупательская_активность` и `минуты_текущий_месяц`;
      * `тип_сервиса` и `длительность`;
      * `частота_акционных_покупок` и `страниц_за_визит`;
      * `частота_акционных_покупок` времени на сайте;
    * есть слабые связи:
      * `разрешить_сообщать` и `длительность`;
      * `популярная_категория` и кластер выручки.
* между категориальными признаками:
    * доля покупателей со сниженной активностью сильно больше среди тех, кто часто, средне или хотя бы иногда пользовался акциями;
    * среди премиум-пользователей доля сниженной активности немного больше;
    * доля снизившейся активности меньше среди пользователей, выбирающих категории `Мелкая бытовая техника и электроника` и `Техника для красоты и здоровья`;
    * доля снизившейся активности больше среди пользователей, выбирающих категории `Кухонная посуда`, `Косметика и аксессуары` и `Товары для детей`;
    * разрешение сообщать дополнительную информацию не связано со снижением активности;
    * среди премиум-пользователей доля сниженной активности немного больше.
6. Для устранения **мультиколлинеарности** решили:
* выбрать из 2 кластеров (пункт 5.1.1) по одному признаку, оказывающему наибольшее влияние на целевой признак `покупательская активность` (определено в пункте 5.1.2):
  * `минуты_2_мес`;
  * `выручка_2_мес_назад`;
* выбрать категориальную форму представления акционной активности.
7. Построили пайплайны для подготовки данных к обучению и обучения модели. Выбрали лучшую модель и ее гиперпараметры, а также лучший метод масштабирования. В основу отбора положили метрику ROC-AUC.
8. **Лучшая модель**: SVC с ядром rbf, для которой количественные признаки были масштабированы RobustScaler(). Она показала значение метрики 0.92 на тренирововчной выборке и 0.87 – на тестовой.
9. Методом SHAP проанализировали **важность признаков** для модели:
* Наиболее значительными для модели оказались признаки:
    * минуты на сайте в позапрошлом месяце;
    * количество просмотренных страниц за визит;
    * частота акционных покупок.
* Наименьшее влияние на ответы модели оказали признаки:
    * популярная категория
    * тип сервиса
    * число ошибок сервиса
    * активность в текущем месяце
    * длительность пользования сервисом
10. Выполнили **сегментацию покупателей**: 
* при помощи диаграммы рассеяния выбрали группу пользователей, для которых модель оценила вероятность снижения от 0.9 и выше, а получаемая прибыль находится в диапазоне от 2.5 до 5.5 включительно;
* провели исследовательский анализ данных о выбранном сегменте и обнаружили, что по сравнению с несегментированной выборкой, для выбранной группы характерны следующие отличительные черты:
    * сниженная активность за 6 месяцев (ожидаемо);
    * длительность в среднем выше;
    * количество просмотренных категорий за визит меньше;
    * распределение числа неоплаченных продуктов более пологое, среднее больше медианы;
    * число просмотренных за визит страниц значительно меньше;
    * время на сайте примерно на 3 минуты меньше;
    * доля пользователей со снизившейся активностью больше;
    * доля разрешивших присылать сообщение такая же;
    * увеличены доли тех, кто часто, средне и иногда пользуется акциями, почти нет тех, кто редко покупает что-то по акции;

* сформулировали предложения, как увеличить покупательскую активность выбранной группы:
    * рассмотреть возможные связи снижения активности клиентов с изменениями акционной или информационной политики (и соотвественно возобновить популярные акции или информирование);
    * изменить отображение акций, чтобы заинтересовавшийся скидкой пользователь переходил в категорию и видел другие товары;
    * присылать пользователям уведомления об акциях на неоплаченные товары из их корзин.
